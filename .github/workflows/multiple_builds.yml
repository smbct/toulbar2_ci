name: Multiple builds test

on:
  workflow_dispatch:

# working-directory: ${{runner.workspace}}/toulbar2/build

jobs:

  toulbar2-checkout:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

  windows-build:
    runs-on: windows-latest
    needs: toulbar2-checkout
    permissions:
      contents: write
    
    steps:
      # - uses: actions/checkout@v4

      - name: Windows build
        uses: ${{runner.workspace}}/toulbar2/.github/actions/windows_build
        with:
          pytb2: 'OFF'

  # macos-build:

  linux-build:
    runs-on: ubuntu-latest
    needs: toulbar2-checkout
    permissions:
      contents: write
    
    steps:
      # - uses: actions/checkout@v4

      - name: Linux build
        uses: ${{runner.workspace}}/toulbar2/.github/actions/linux_build
        with:
          pytb2: 'OFF'
          mpi: 'OFF'

  

      # - uses: ncipollo/release-action@v1
      #   with:
      #     artifacts: "release.tar.gz,foo/*.txt"
      #     bodyFile: "body.md"
  
  post_build:
    runs-on: ubuntu-latest
    needs: [windows-build, linux-build]

    steps:

      - name: test
        shell: bash
        run: ls ${{runner.workspace}}/toulbar2/build/lib